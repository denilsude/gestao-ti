{% extends "base.html" %}
{% block content %}

<h2 class="mb-4">Central de Processos</h2>

<div class="row g-4 mb-5">
  <div class="col-md-6">
    <div class="card h-100 shadow-sm border-0" style="border-top: 5px solid var(--sicoob-turquesa) !important;">
      <div class="card-body">
        <h4 class="card-title mb-3" style="color: var(--sicoob-verde-escuro)">Nova Admissão</h4>
        <p class="card-text text-muted">Cadastrar novo colaborador, gerar credenciais e definir acessos.</p>
        
        <form action="{{ url_for('checklists.iniciar_processo_admissao') }}" method="POST" class="mt-4">
            <div class="mb-3">
                <label class="form-label">Nome Completo</label>
                <input type="text" class="form-control" name="nome_novo_funcionario" required>
             </div>
             <div class="row mb-3">
                 <div class="col-8">
                    <select name="cargo_selecionado" class="form-select" required>
                      <option value="" selected disabled>Cargo...</option>
                      {% for key, dados in cargos.items() %}
                        <option value="{{ key }}">{{ dados.nome }}</option>
                      {% endfor %}
                    </select>
                 </div>
                 <div class="col-4">
                    <input type="text" class="form-control" name="num_pa" placeholder="PA" required>
                 </div>
             </div>

          <button type="submit" class="btn btn-success w-100 fw-bold">INICIAR ADMISSÃO</button>
        </form>
      </div>
    </div>
  </div>

  <div class="col-md-6">
    <div class="card h-100 shadow-sm border-0" style="border-top: 5px solid #6c757d !important;">
      <div class="card-body">
        <h4 class="card-title mb-3">Gestão de Colaborador</h4>
        <p class="card-text text-muted">Demissão, Férias, Troca de PA para quem já está na base.</p>
        
        <form action="{{ url_for('checklists.iniciar_processo_existente') }}" method="POST" class="mt-4">
            <div class="mb-3">
                <select name="tipo" class="form-select" required>
                  <option value="" selected disabled>Tipo de Processo...</option>
                  <option value="demissao">Demissão</option>
                  <option value="ferias">Férias</option>
                  <option value="troca_pa">Troca de PA</option>
                </select>
            </div>
            <div class="mb-3">
                <select name="funcionario_id" class="form-select" required>
                  <option value="" selected disabled>Selecione o Colaborador...</option>
                  {% for f in funcionarios %}
                    <option value="{{ f.id }}">{{ f.nome }}</option>
                  {% endfor %}
                </select>
            </div>

          <button type="submit" class="btn btn-primary w-100 fw-bold" style="background-color: var(--sicoob-verde-escuro)">INICIAR PROCESSO</button>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="card border-0 shadow-sm">
    <div class="card-header bg-white border-bottom">
        <h5 class="mb-0 text-muted">Processos em Andamento</h5>
    </div>
    <div class="list-group list-group-flush">
      {% for proc in processos %}
        <a href="{{ url_for('checklists.ver_processo', processo_id=proc.id) }}" class="list-group-item list-group-item-action p-3">
          <div class="d-flex w-100 justify-content-between align-items-center">
            <div>
                <h5 class="mb-1 text-primary fw-bold">{{ proc.tipo.replace('_', ' ').title() }}</h5>
                <span class="text-dark fs-5">{{ proc.funcionario.nome }}</span>
            </div>
            <small class="text-muted text-end">
                Iniciado em {{ proc.created_at.strftime('%d/%m') }}<br>
                por {{ proc.ti_user.username }}
            </small>
          </div>
          
          {% set total = proc.items|length %}
          {% set concluidos = proc.items|selectattr('status', 'equalto', 'Concluído')|list|length %}
          {% if total > 0 %}
            {% set progresso = (concluidos / total) * 100 %}
            <div class="progress mt-2" style="height: 4px;">
              <div class="progress-bar bg-success" style="width: {{ progresso }}%;"></div>
            </div>
          {% endif %}
        </a>
      {% else %}
        <div class="p-5 text-center text-muted">
            <h3 class="mb-3">✅</h3>
            <h5>Tudo limpo!</h5>
            <p>Nenhum processo pendente no momento.</p>
        </div>
      {% endfor %}
    </div>
</div>

{% endblock %}